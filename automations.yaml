# Temperatura CPU
- alias: CPU Alta
  trigger:
  - platform: numeric_state
    entity_id: sensor.cpu_temperature
    above: '60'
    below: '70'
  action:
  - service: notify.telegram_group
    data:
      message: >
       *Temp. CPU Alta* - {{ states.sensor.cpu_temperature.state }} ºC
- alias: CPU Muito Alta
  trigger:
  - platform: numeric_state
    entity_id: sensor.cpu_temperature
    above: '70'
  action:
  - service: notify.telegram_group
    data:
      message: > 
       *Temp. CPU Multo Alta* - {{ states.sensor.cpu_temperature.state }} ºC

# Manter sensor broadlink OFF
- alias: Broadlink Always OFF
  trigger:
  - entity_id: switch.0_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.0_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.1_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.1_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.2_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.2_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.3_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.3_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.4_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.4_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.5_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.5_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.6_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.6_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.7_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.7_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.8_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.8_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.9_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.9_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.baixo_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.baixo_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.canal_baixo_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.canal_baixo_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.canal_cima_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.canal_cima_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.cima_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.cima_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.direita_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.direita_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.esquerda_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.esquerda_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.mute_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.mute_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.ok_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.ok_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.portao
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.power_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.power_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.power_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.power_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.source_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.source_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.vol_baixo_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.vol_baixo_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.vol_cima_tv_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.vol_cima_tv_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.source_chromecast_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.source_net_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.source_dvd_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.power_dvd_sala
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: script.source_chromecast_quarto
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: script.source_net_quarto
    from: 'off'
    platform: state
    to: 'on'
  action:
  - alias: Broadlink Always OFF
    data_template:
      entity: '{{ trigger.entity_id }}

        '
    service: python_script.set_state

# Placa do carro
- alias: Placa carro
  trigger:
  - event_data:
      entity_id: image_processing.openalpr_frente
      plate: ASC8060
    event_type: image_processing.found_plate
    platform: event
  - event_data:
      entity_id: image_processing.openalpr_frente
      plate: OXI5924
    event_type: image_processing.found_plate
    platform: event
  - event_data: {}
    event_type: image_processing.found_plate
    platform: event
  action:
  - service: notify.telegram_bot
    data:
      message: Placa encontrada.
    
# Telegram Portão
- alias: 'Portão ON/OFF'
  action:
  - data:
      message: '*Portão* acionado.'
    service: notify.telegram_group
  trigger:
  - entity_id: switch.portao
    from: 'off'
    platform: state
    to: 'on'

# Inicio e Parada do FRIS
- alias: 'FRIS Start'
  action:
  - data_template:
      message: '*FRIS Automação* iniciado.'
    service: notify.telegram_group
  trigger:
  - event: start
    platform: homeassistant
- alias: 'FRIS Stop'
  action:
  - service: notify.telegram_group
    data_template:
      message: '*FRIS Automação* desligado.'
  trigger:
  - event: shutdown
    platform: homeassistant

# Previsão de tempo 7 dias
- alias: 'Atualiza Nomes Previsão'
  id: update_friendly_names
  initial_state: 'on'
  trigger:
  - at: 0:05:00
    platform: time
  - entity_id: sensor.forecast_1
    platform: state
  - entity_id: sensor.forecast_2
    platform: state
  - entity_id: sensor.forecast_3
    platform: state
  - entity_id: sensor.forecast_4
    platform: state
  - entity_id: sensor.forecast_5
    platform: state
  - entity_id: sensor.forecast_6
    platform: state
  - entity_id: sensor.forecast_7
    platform: state
  action:
  - data_template:
      entityid: '{{trigger.entity_id}}'
    service: python_script.dark_sky_friendly_names

# Backup
- alias: 'Backup diário'
  trigger:
  - platform: template
    value_template: "{{ states.sensor.time.state == (states.input_datetime.hora_backup.attributes.timestamp | int | timestamp_custom('%H:%M', false)) }}"
  condition:
    condition: state
    entity_id: input_boolean.fazer_backup
    state: 'on'
  action:
  - service: hassio.snapshot_full
    data_template:
      name: FRIS {{ now().strftime('%Y-%m-%d') }}
  - service: notify.telegram_group
    data_template:
      message: Criando Snapshot "FRIS {{ now().strftime('%Y-%m-%d') }}"
  - delay: 03:00:00
  - data:
      entity_id: switch.del_snap_files
    service: switch.toggle
  - delay: 00:10:00
  - data:
      addon: 7be23ff5_dropbox_sync
    service: hassio.addon_restart
- alias: 'Novo arquivo backup'
  trigger:
    platform: state
    entity_id: sensor.count_snap_files
  action:
  - service: notify.telegram_group
    data_template:
      message: >
        Número de arquivos de backups {{ states.sensor.count_snap_files.state }}

# Velocidade Internet
- alias: 'Velocidade Internet Baixa'
  trigger:
  - below: '30'
    entity_id: sensor.speedtest_download
    platform: numeric_state
  action:
  - service: notify.telegram_group
    data_template:
      message: 'Velocidade Internet Baixa - Download {{ states(''sensor.speedtest_download'') }} Mbit/s

        '

# Device Tracker
- alias: 'Robson chegou em casa'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'home'
  action:
    - service: notify.telegram_group
      data:
        message: 'Olá *Robson*, bem vindo a sua casa. Deseja executar uma das ações favoritas:'
        data:
          inline_keyboard:
            - 'Portão:/portao'
            - 'Liga TV SBT:/ligasbtsala, Canal SBT:/canalsbtsala'
            - 'Liga TV Record:/ligarecordsala, Canal Record:/canalrecordsala'
            - 'Liga TV Globo:/ligaglobosala, Canal Globo:/canalglobosala'
            - 'Liga TV Discovery:/ligadiscoverysala, Canal Discovery:/canaldiscoverysala'
- alias: 'Robson chegou na BRF'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'BRF'
  action:
    - service: notify.telegram_group
      data:
        message: 'Robson chegou na BRF.'
- alias: 'Robson chegou no Sogro'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'sogro'
  action:
    - service: notify.telegram_group
      data:
        message: 'Robson chegou no sogro.'
- alias: 'Robson chegou na Escola'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'escola'
  action:
    - service: notify.telegram_group
      data:
        message: 'Robson chegou no escola.'
- alias: 'Robson chegou na casa dos pais'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'pais'
  action:
    - service: notify.telegram_group
      data:
        message: 'Robson chegou na casa dos pais.'
- alias: 'Robson saiu de casa'
  trigger:
  - platform: state
    entity_id: device_tracker.52008849ec808451
    to: 'not_home'
  action:
    - service: notify.telegram_group
      data:
        message: 'Robson não está em um local mapeado.'
- alias: 'Liga Globo Flavia Chegou'
  trigger:
  - platform: state
    entity_id: device_tracker.iphonedeflavialan
    from: 'not_home'
    to: 'home'
  condition:
  - condition: time
    # At least one of the following is required.
    after: '18:00:00'
    before: '19:00:00'
    weekday:
      - mon 
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.liga_tv_sala_globo

# Comandos Telegram
- alias: 'Lista de Comandos Telegram'
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: '/inicio'
  - platform: event
    event_type: telegram_callback
    event_data:
      data: '/voltarhome'
  action:
    - service: notify.telegram_bot
      data:
        message: 'Bem vindo automação residencial *FRIS Automação*. Selecione um dos menus abaixo:'
        data:
          inline_keyboard:
            - 'Térreo:/terreo, Controle Sala:/controlesala'
            - 'Quarto:/quarto, Controle Quarto:/controlequarto'
            - 'Portão:/portao'
- alias: 'Lista de Comandos Telegram Terreo'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/terreo'
  action:
    - service: notify.telegram_bot
      data:
        message: 'Comandos de automação do *Térreo*:'
        data:
          inline_keyboard:
            - 'Luz Esquerda:/luzesquerda, Luz Central:/luzcentral, Luz Direita:/luzdireita'
            - 'Display:/display, Spot:/spot, Cervejeira:/cervejeira'
            - 'Voltar:/voltarhome'
- alias: 'Lista de Comandos Telegram Controle Sala'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/controlesala'    
  action:
    - service: notify.telegram_bot
      data:
        message: 'Controle remoto da *TV da Sala*:'
        data:
          inline_keyboard:
            - 'Liga TV Net:/tvnetsala'
            - 'Src Net:/srcnetsala, Src Chromecast:/srcchromesala'
            - 'Volume +:/volumemaissala, Volume -:/volumemenossala'
            - 'Liga TV SBT:/ligasbtsala, Canal SBT:/canalsbtsala'
            - 'Liga TV Record:/ligarecordsala, Canal Record:/canalrecordsala'
            - 'Liga TV Globo:/ligaglobosala, Canal Globo:/canalglobosala'
            - 'Liga TV Discovery:/ligadiscoverysala, Canal Discovery:/canaldiscoverysala'
            - 'Voltar:/voltarhome'
- alias: 'Lista de Comandos Telegram Controle Quarto'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/controlequarto'    
  action:
    - service: notify.telegram_bot
      data:
        message: 'Controle remoto da *TV do Quarto*:'
        data:
          inline_keyboard:
            - 'Liga TV Net:/tvnetquarto'
            - 'Src Net:/srcnetquarto, Src Chromecast:/srcchromequarto'
            - 'Volume +:/volumemaisquarto, Volume -:/volumemenosquarto'
            - 'Liga TV SBT:/ligasbtquarto, Canal SBT:/canalsbtquarto'
            - 'Liga TV Record:/ligarecordquarto, Canal Record:/canalrecordquarto'
            - 'Liga TV Globo:/ligagloboquarto, Canal Globo:/canalgloboquarto'
            - 'Liga TV Discovery:/ligadiscoveryquarto, Canal Discovery:/canaldiscoveryquarto'
            - 'Voltar:/voltarhome'
- alias: 'Lista de Comandos Telegram Quarto'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/quarto'    
  action:
    - service: notify.telegram_bot
      data:
        message: 'Comandos de automação dos *Quarto*:'
        data:
          inline_keyboard:
            - 'Luz Corredor:/luzcorredor'
            - 'Luz Quarto:/luzquarto, Luz Painel:/luzpainel, Luz Sacada:/luzsacada'
            - 'Voltar:/voltarhome'

# Comandos da Lista de Comandos do Térreo
- alias: 'Comando Telegram Luz Esquerda'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/luzesquerda'
  action:
    - service: light.toggle
      data:
        entity_id: light.luz_esquerda
- alias: 'Comando Telegram Luz Central'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/luzcentral'
  action:
    - service: light.toggle
      data:
        entity_id: light.luz_central
- alias: 'Comando Telegram Luz Direita'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/luzdireita'
  action:
    - service: light.toggle
      data:
        entity_id: light.luz_direita      
- alias: 'Comando Telegram Display'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/display'
  action:
    - service: switch.toggle
      data:
        entity_id: switch.display      
- alias: 'Comando Telegram Spot'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/spot'
  action:
    - service: switch.toggle
      data:
        entity_id: switch.garden_light
- alias: 'Comando Telegram Cervejeira'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/cervejeira'
  action:
    - service: input_boolean.toggle
      data:
        entity_id: input_boolean.beer_fridge
        
# Comando Portão
- alias: 'Comando Telegram portão'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/portao'
  action:
    - service: switch.toggle
      data:
        entity_id: switch.portao

# Comandos da Lista de Comandos da Sala
- alias: 'Comando Telegram TV Sala'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/tvnetsala'
  action:
    - service: script.toggle
      data:
        entity_id: script.liga_tv_net_sala
- alias: 'Comando Telegram Source Net Sala'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/srcnet'
  action:
    - service: switch.toggle
      data:
        entity_id: switch.source_net_sala
- alias: 'Comando Telegram Source Chromecast Sala'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/srcchrome'
  action:
    - service: switch.toggle
      data:
        entity_id: switch.source_chromecast_sala
        
# Lista de Comandos Saindo de Casa
- alias: 'Robson saindo de casa'
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: '/sair_casa'
  - platform: event
    event_type: telegram_callback
    event_data:
      data: '/sair_casa'
  action:
    - service: notify.telegram_bot
      data_template:
        message: 'Olá *Robson*, você está saindo de casa, seguem seus atalhos :'
        data:
          inline_keyboard:
            - 'Portão:/portao'
            - 'Waze BRF ({{ states.sensor.para_brf.attributes.duration }}):/wazebrf, Waze Sogro ({{ states.sensor.para_sogro.attributes.duration }}):/wazesogro'
            - 'Waze Pai ({{ states.sensor.para_pai.attributes.duration }}):/wazepai, Waze Escola ({{ states.sensor.para_escola_isabelle.attributes.duration }}):/wazeescola'
            - 'Waze Comprimisso ({{ states.sensor.para_compromisso.attributes.duration }}):/wazecompromisso'
            - 'Musica Rock:/musicarock, Musica Familia:/musicafamilia'

# Comando Waze
- alias: 'Comando Waze BRF'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/wazebrf'
  action:
    - service: notify.telegram_bot
      data:
        message: 'https://waze.com/ul?favorite=BRF&navigate=yes'
- alias: 'Comando Waze Sogro'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/wazesogro'
  action:
    - service: notify.telegram_bot
      data:
        message: 'https://waze.com/ul?favorite=Sogro&navigate=yes'
- alias: 'Comando Waze Pai'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/wazepai'
  action:
    - service: notify.telegram_bot
      data:
        message: 'https://waze.com/ul?favorite=CostaGaragem&navigate=yes'
- alias: 'Comando Waze Escola Isabelle'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/wazeescola'
  action:
    - service: notify.telegram_bot
      data:
        message: 'https://waze.com/ul?favorite=EscolaIsabelle&navigate=yes'
- alias: 'Comando Waze Próximo Compromisso'
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/wazecompromisso'
  action:
    - service: notify.telegram_bot
      data_template:
        message: 'https://waze.com/ul?q={{ states.sensor.para_compromisso.attributes["destination_addresses"]|replace(" ", "+") }}'

# Camando Start
- alias: 'Start'
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/start'
  action:
    - service: notify.telegram_bot
      data:
        message: 'Atualizando comandos para *FRIS Automação*'
        data:
          keyboard:
            - '/inicio'
            - '/boletim'
            - '/sair_casa'
            
# Flash Briefing
- alias: 'Flashbriefing'
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
      command: '/boletim'
  - platform: template
    value_template: "{{ states.sensor.time.state == (states.input_datetime.boletim_1.attributes.timestamp | int | timestamp_custom('%H:%M', false)) }}"
  - platform: template
    value_template: "{{ states.sensor.time.state == (states.input_datetime.boletim_2.attributes.timestamp | int | timestamp_custom('%H:%M', false)) }}"
  - platform: template
    value_template: "{{ states.sensor.time.state == (states.input_datetime.boletim_3.attributes.timestamp | int | timestamp_custom('%H:%M', false)) }}"
  action:
    - service: shell_command.excluir_ultimo_flashbriefing
    - service: script.saudacao_texto
    - service: script.saudacao_voz
    - service: script.clima_texto
    - service: script.clima_voz
    - service: script.mercado_financeiro_texto
    - service: script.mercado_financeiro_voz
    - service: script.proximo_compromisso_texto
    - service: script.proximo_compromisso_voz
    - delay: 00:00:03
    - service: tts.google_say
      entity_id: media_player.quarto_fake
      data_template:
        language: 'pt'
        message: >
         {{ states.input_text.saudacao_voz.state }}
         {{ states.input_text.clima_voz.state }}
         {{ states.input_text.mercado_financeiro_voz.state }}
         {{ states.input_text.proximo_compromisso_voz.state }}
    - delay: 00:00:30
    - service: shell_command.renomear_flashbriefing
    - delay: 00:00:03
    - service: notify.telegram_bot
      data_template:
        message: >
          {{ states.input_text.saudacao_texto.state }}
    - service: notify.telegram_bot
      data_template:
        message: >
          {{ states.input_text.clima_texto.state }}
    - service: notify.telegram_bot
      data_template:
        message: >
         {{ states.input_text.mercado_financeiro_texto.state }}
    - service: notify.telegram_bot
      data_template:
        message: >
         {{ states.input_text.proximo_compromisso_texto.state }}
    - service: telegram_bot.send_video
      data:
        file: /config/tts/FlashBriefing.mp3

# Guardar valor do bitcoin
- alias: 'Guardar Valor do Bitcoin'
  trigger:
  - platform: time
    at: '00:00:00'
  action:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.valor_bitcoin_meianoite_ontem
        value: >
          {{ states.input_number.valor_bitcoin_meianoite.state }}
    - service: input_number.set_value
      data_template:
        entity_id: input_number.valor_bitcoin_meianoite
        value: '{{ states.sensor.exchange_rate_1_btc.state | float}}'
        
# Envia invalid configuration
- alias: 'Envio invalid configuration'
  trigger:
  - platform: state
    entity_id: persistent_notification.invalid_config
    to: 'notifying' 
  action:
    - service: notify.telegram_group
      data_template:
        title: >
          {{ states.persistent_notification.invalid_config.attributes.title }}
        message: >
          {{ states.persistent_notification.invalid_config.attributes.message }}
    
# Liga / Desliga Cervejeira
- alias: Cervejeira On
  trigger:
  - entity_id: input_boolean.beer_fridge
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: ifttt.trigger
    data:
      event: beer_fridge_on
- alias: Cervejeira Off
  trigger:
  - entity_id: input_boolean.beer_fridge
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: beer_fridge_off

# Liga / Desliga Luz Corredor
- alias: Luz Corredor On
  trigger:
  - entity_id: input_boolean.hall_light
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: ifttt.trigger
    data:
      event: hall_light_on
- alias: Luz Corredor Off
  trigger:
  - entity_id: input_boolean.hall_light
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: hall_light_off

# Liga / Desliga Luz Quarto
- alias: Luz Quarto On
  trigger:
  - entity_id: input_boolean.quarto
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: ifttt.trigger
    data:
      event: quarto_on
- alias: Luz Quarto Off
  trigger:
  - entity_id: input_boolean.quarto
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: quarto_off
    
# Liga / Desliga Luz Sacada Frente
- alias: Luz Sacada Frente On
  trigger:
  - entity_id: input_boolean.sacada_frente
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: ifttt.trigger
    data:
      event: sacada_frente_on
- alias: Luz Sacada Frente Off
  trigger:
  - entity_id: input_boolean.sacada_frente
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: sacada_frente_off

# Liga / Desliga Luz Painel Quarto
- alias: Luz Painel Quarto On
  trigger:
  - entity_id: input_boolean.painel_quarto
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: ifttt.trigger
    data:
      event: painel_quarto_on
- alias: Luz Painel Quarto Off
  trigger:
  - entity_id: input_boolean.painel_quarto
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: painel_quarto_off
      
# Ativa timer TV Isabelle
- alias: Ativa Timer TV Isabelle
  trigger:
  - entity_id: input_boolean.ativa_timer_tv_isabelle
    platform: state
    to: 'on'
  action:
  - service: input_datetime.set_datetime
    entity_id: input_datetime.timer_tv_isabelle
    data_template:
      time: "{{ (as_timestamp(now()) + (states.input_number.tempo_timer.state | int * 60)) | timestamp_custom('%H:%M:00', true) }}"
      date: "{{ (as_timestamp(now()) + (states.input_number.tempo_timer.state | int * 60))  | timestamp_custom('%Y-%m-%d', true) }}"
  - service: notify.telegram_bot
    data_template:
      message: "*Timer* iniciado para *TV Isabelle*, fim as {{ (as_timestamp(now()) + (states.input_number.tempo_timer.state | int * 60)) | timestamp_custom('%H:%M:00', true) }}"
# Fim timer TV Isabelle
- alias: Fim timer TV Isabelle
  trigger:
  - platform: template
    value_template: "{{ states.sensor.date__time.state == (states.input_datetime.timer_tv_isabelle.attributes.timestamp | int | timestamp_custom('%Y-%m-%d, %H:%M', true)) }}"
  action:
    - service: media_player.turn_off
      entity_id: media_player.quarto_isabelle
    - service: notify.telegram_bot
      data_template:
        message: '*TV da Isabelle desligada.*'
    - service: input_boolean.turn_off
      entity_id: input_boolean.ativa_timer_tv_isabelle
    - service: tts.google_say
      entity_id: media_player.quarto_isabelle
      data: 
       message: 'Timer finalizado, hora de dormir. Boa noite.'
       language: pt
    - service: media_player.play_media
      data:
        entity_id: media_player.quarto_isabelle
        media_content_id: 'https://fris.duckdns.org:8123/local/Ninar.mp4'
        media_content_type: 'VIDEO'